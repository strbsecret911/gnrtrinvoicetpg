<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TOPUPGRAM - Generator Struk</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">TPG</div>
      <div>
        <div class="title">TOPUPGRAM</div>
        <div class="subtitle">Generator Struk Pembelian</div>
      </div>
    </div>
    <div class="status" id="status">Siap.</div>
  </header>

  <main class="grid">
    <!-- FORM -->
    <section class="card">
      <h2>Input Transaksi</h2>

      <div class="form">
        <div class="row">
          <label for="datetime">Waktu</label>
          <input type="datetime-local" id="datetime" />
        </div>

        <div class="row">
          <label for="buyerName">Nama Pembeli</label>
          <input type="text" id="buyerName" placeholder="Contoh: Dini" />
        </div>

        <div class="row">
          <label for="buyerId">ID/No (opsional)</label>
          <input type="text" id="buyerId" placeholder="Contoh: 62812xxxx / UserID ML" />
        </div>

        <div class="row">
          <label for="category">Kategori</label>
          <select id="category"></select>
        </div>

        <div class="row">
          <label for="product">Produk</label>
          <select id="product"></select>
        </div>

        <div class="row two">
          <div>
            <label for="qty">Jumlah</label>
            <input type="number" id="qty" min="1" value="1" />
          </div>
          <div>
            <label for="price">Harga / Item (Rp)</label>
            <input type="number" id="price" min="0" value="0" />
          </div>
        </div>

        <div class="row">
          <label for="note">Catatan (opsional)</label>
          <textarea id="note" rows="3" placeholder="Contoh: Proses 5-10 menit"></textarea>
        </div>

        <div class="actions">
          <button class="btn" id="btnGenerate">Generate Kode + Invoice</button>
          <button class="btn secondary" id="btnUpdatePreview" title="Update preview tanpa buat kode baru">Update Preview</button>
          <button class="btn success" id="btnSaveJpg">Save Photo (JPG)</button>
        </div>

        <p class="hint">
          * Tombol <b>Generate</b> akan membuat <b>Invoice</b> + <b>Kode Pembelian</b> (sekali pakai) dari Firestore.<br/>
          * Tombol <b>Update Preview</b> hanya memperbarui tampilan struk tanpa membuat kode baru.
        </p>
      </div>
    </section>

    <!-- PREVIEW STRUK -->
    <section class="card">
      <h2>Preview Struk</h2>

      <div class="receiptWrap">
        <div id="receipt" class="receipt">
          <div class="watermark">TOPUPGRAM</div>

          <div class="receiptHeader">
            <div>
              <div class="rTitle">TOPUPGRAM</div>
              <div class="rSub">Struk Pembelian</div>
            </div>
            <div class="rMeta">
              <div><span>Invoice</span><b id="rInvoice">-</b></div>
              <div><span>Kode</span><b id="rCode">-</b></div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="rGrid">
            <div class="kv"><span>Waktu</span><b id="rTime">-</b></div>
            <div class="kv"><span>Pembeli</span><b id="rBuyer">-</b></div>
            <div class="kv"><span>ID/No</span><b id="rBuyerId">-</b></div>
            <div class="kv"><span>Kategori</span><b id="rCategory">-</b></div>
            <div class="kv"><span>Produk</span><b id="rProduct">-</b></div>
            <div class="kv"><span>Jumlah</span><b id="rQty">-</b></div>
            <div class="kv"><span>Harga/Item</span><b id="rPrice">-</b></div>
          </div>

          <div class="divider"></div>

          <div class="totalRow">
            <span>Total</span>
            <b id="rTotal">Rp 0</b>
          </div>

          <div class="noteBox">
            <div class="noteTitle">Catatan</div>
            <div id="rNote" class="noteText">-</div>
          </div>

          <div class="footer">
            <div>Terima kasih sudah order ðŸ’œ</div>
            <div class="small">Watermark: TOPUPGRAM â€¢ Generated via Web</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- html2canvas untuk export JPG -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- app.js pakai ES Modules -->
  <script type="module" src="./app.js"></script>
</body>
</html>
